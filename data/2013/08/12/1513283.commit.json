{
  "when": "2013-08-12T18:23:17-04:00", 
  "who": "hiranya", 
  "changes": [
    {
      "chunks": [
        {
          "locn": "-64,7 +64,22", 
          "lines": [
            "             </p>\n", 
            "             <p>\n", 
            "                 Similar to the NHTTP transport, the PTHTTP transport is also based on the Apache\n", 
            "-                HTTP Core NIO library.\n", 
            "+                HTTP Core NIO library. This library is based on the <a href=\"http://en.wikipedia.org/wiki/Reactor_pattern\">reactor pattern</a>,\n", 
            "+                and the PTHTTP transport uses two separate reactor instances:\n", 
            "+                <ul>\n", 
            "+                    <li>\n", 
            "+                        Listening I/O reactor: Handles network interactions between client\n", 
            "+                        applications and Synapse.\n", 
            "+                    </li>\n", 
            "+                    <li>\n", 
            "+                        Connecting I/O reactor: Handles network interactions between Synapse and\n", 
            "+                        the backend services.\n", 
            "+                    </li>\n", 
            "+                </ul>\n", 
            "+                Each reactor instance uses its own set of threads and in addition, the PTHTTP transport\n", 
            "+                uses a separate configurable thread pool for processing received messages through\n", 
            "+                the mediation engine. Settings related to configuring I/O reactor threads and PTHTTP\n", 
            "+                threads are discussed under <a href=\"#AdvancedSettings\">advanced settings</a>.\n", 
            "             </p>\n", 
            "         </section>\n", 
            "         <section name=\"Transport Configuration\" id=\"Configuration\">\n"
          ]
        }, 
        {
          "locn": "-559,6 +574,20", 
          "lines": [
            "                         <td>Default</td>\n", 
            "                     </tr>\n", 
            "                     <tr>\n", 
            "+                        <td>novalidatecert</td>\n", 
            "+                        <td>\n", 
            "+                            Use this parameter to turn on/off server certificate validation. If set to\n", 
            "+                            'true', the HTTPS sender will not attempt to validate the certificates\n", 
            "+                            presented by the remote servers. This behavior, however, is not recommended\n", 
            "+                            for production deployments due to the potential security risks. If the\n", 
            "+                            truststore parameter is specified, the value of this parameter is ignored\n", 
            "+                            altogether.\n", 
            "+                            <div class=\"xmlConf\">&lt;parameter name=\"novalidatecert\"&gt;true&lt;/parameter&gt;</div>\n", 
            "+                        </td>\n", 
            "+                        <td>No</td>\n", 
            "+                        <td>false</td>\n", 
            "+                    </tr>\n", 
            "+                    <tr>\n", 
            "                         <td>customSSLProfiles</td>\n", 
            "                         <td>\n", 
            "                             By default, the HTTPS sender uses the SSL settings configured under\n"
          ]
        }, 
        {
          "locn": "-566,7 +595,7", 
          "lines": [
            "                             HTTPS endpoints. However, in some cases we may need to use different\n", 
            "                             SSL settings to communicate with different endpoints. The customSSLProfiles\n", 
            "                             parameter allows configuring separate keystores and truststores for\n", 
            "-                            each target server. The value of this parameter is a set of XML elements\n", 
            "+                            each destination server. The value of this parameter is a set of XML elements\n", 
            "                             (profile elements). Each profile element must be configured with the following\n", 
            "                             child elements:\n", 
            "                             <ul>\n"
          ]
        }, 
        {
          "locn": "-573,12 +602,12", 
          "lines": [
            "                                 <li>servers: A comma-separated list of servers to which this SSL profile is related to</li>\n", 
            "                                 <li>KeyStore: A keystore configuration (similar to the keystore parameter)</li>\n", 
            "                                 <li>TrustStore: A truststore configuration (similar to the truststore parameter)</li>\n", 
            "-                                <li>novalidatecert: Optional parameter to disable certification validation</li>\n", 
            "+                                <li>novalidatecert: Optional element to disable certification validation (can be set to true or false)</li>\n", 
            "                             </ul>\n", 
            "                             An example is given below. According to this configuration, when Synapse\n", 
            "                             communicates with server1.example.com or server2.example.com, it will use\n", 
            "                             the first SSL configuration (identity1.jks and trust1.jks). When\n", 
            "-                            communicating with server3.example.com it will use the second SSL\n", 
            "+                            communicating with server3.example.com, it will use the second SSL\n", 
            "                             configuration (identity2.jks and trust2.jks). For all other endpoints,\n", 
            "                             Synapse will use the default SSL configuration, configured under keystore\n", 
            "                             and truststore parameters.\n"
          ]
        }, 
        {
          "locn": "-616,8 +645,294", 
          "lines": [
            "                         <td>No</td>\n", 
            "                         <td>N/A</td>\n", 
            "                     </tr>\n", 
            "+                    <tr>\n", 
            "+                        <td>CertificateRevocationVerifier</td>\n", 
            "+                        <td>\n", 
            "+                            Enable revocation status validation of server certificates using\n", 
            "+                            <a href=\"http://www.ietf.org/rfc/rfc2560.txt\">OCSP</a> and\n", 
            "+                            <a href=\"http://www.ietf.org/rfc/rfc5280.txt\">CRL</a>. Simply uncommenting\n", 
            "+                            this parameter under the HTTPS sender configuration will activate the\n", 
            "+                            feature. Two LRU caches are used to cache CRLs and OCSP responses until\n", 
            "+                            they are expired. Two child XML elements are used to configure the cache\n", 
            "+                            behavior.\n", 
            "+                            <ul>\n", 
            "+                                <li>\n", 
            "+                                    CacheSize: Controls the maximum size of each cache. When this\n", 
            "+                                    limit is reached, the old values will be automatically removed\n", 
            "+                                    and updated with new values. Default value is 50.\n", 
            "+                                </li>\n", 
            "+                                <li>\n", 
            "+                                    CacheDurationMins: Set the time duration (in minutes) between\n", 
            "+                                    two consecutive runs of the CacheManager task which periodically\n", 
            "+                                    performs housekeeping work in each cache. Default value is 15.\n", 
            "+                                </li>\n", 
            "+                            </ul>\n", 
            "+                            <div class=\"xmlConf\">&lt;parameter name=\"CertificateRevocationVerifier\" locked=\"false\"&gt;\n", 
            "+    &lt;CacheSize&gt;100&lt;/CacheSize&gt;\n", 
            "+    &lt;CacheDurationMins&gt;&lt;/CacheDurationMins&gt;\n", 
            "+&lt;/parameter&gt;</div>\n", 
            "+                        </td>\n", 
            "+                        <td>No</td>\n", 
            "+                        <td>N/A</td>\n", 
            "+                    </tr>\n", 
            "                 </table>\n", 
            "             </subsection>\n", 
            "         </section>\n", 
            "+        <section name=\"Advanced Settings and Performance Tuning\" id=\"AdvancedSettings\">\n", 
            "+            <p>\n", 
            "+                In addition to the basic parameters described in the previous section, the\n", 
            "+                Pass Through HTTP transport provides some advanced options to tweak its\n", 
            "+                runtime behavior and performance. These options are configured in the\n", 
            "+                passthru-http.properties file which should be placed in the lib directory of\n", 
            "+                Synapse. These advanced options enable the user to control some of the low-level\n", 
            "+                transport settings related to TCP sockets, I/O buffers and thread pools. Following\n", 
            "+                table describes all the advanced options that can be set for the Pass Through\n", 
            "+                HTTP transport.\n", 
            "+            </p>\n", 
            "+            <table>\n", 
            "+                <tr>\n", 
            "+                    <th>Parameter Name</th>\n", 
            "+                    <th>Description/Example</th>\n", 
            "+                    <th>Required</th>\n", 
            "+                    <th>Default</th>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.socket.timeout</td>\n", 
            "+                    <td>\n", 
            "+                        Set the TCP socket timeout in milliseconds\n", 
            "+                        (See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#SO_TIMEOUT\">SO_TIMEOUT</a>).\n", 
            "+                        <div class=\"xmlConf\">http.socket.timeout=20000</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>60000</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.connection.timeout</td>\n", 
            "+                    <td>\n", 
            "+                        Set the TCP connection timeout in milliseconds. This determines the timeout\n", 
            "+                        value for non-blocking connection requests. Setting this property to\n", 
            "+                        0 disables connection timeout (i.e. no timeout).\n", 
            "+                        <div class=\"xmlConf\">http.connection.timeout=30000</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>0</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.nio.interest-ops-queueing</td>\n", 
            "+                    <td>\n", 
            "+                        Determines whether or not I/O interest operations are to be queued and\n", 
            "+                        executed asynchronously by the I/O reactor thread or to be applied to\n", 
            "+                        the underlying\n", 
            "+                        <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/nio/channels/SelectionKey.html\">SelectionKey</a>\n", 
            "+                        immediately. Allowed values are either 'true' or 'false'.\n", 
            "+                        <div class=\"xmlConf\">http.nio.interest-ops-queueing=false</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>false</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.tcp.nodelay</td>\n", 
            "+                    <td>\n", 
            "+                        Setting this property to 'true' disables\n", 
            "+                        <a href=\"http://en.wikipedia.org/wiki/Nagle's_algorithm\">Nagle's algorithm</a>\n", 
            "+                        for the HTTP connections. That is, outgoing data will not be buffered\n", 
            "+                        and aggregated together\n", 
            "+                        (See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#TCP_NODELAY\">TCP_NODELAY</a>).\n", 
            "+                        <div class=\"xmlConf\">http.tcp.nodelay=true</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>true</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.socket.rcv-buffer-size</td>\n", 
            "+                    <td>\n", 
            "+                        Set the size of the buffers used by the underlying platform\n", 
            "+                        for incoming network I/O. This value is only a hint. When set, this is a\n", 
            "+                        suggestion to the OS kernel from Synapse about the size of buffers to\n", 
            "+                        use for the data to be received over the socket\n", 
            "+                        (See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#SO_RCVBUF\">SO_RCVBUF</a>).\n", 
            "+                        <div class=\"xmlConf\">http.socket.rcv-buffer-size=4096</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>8192</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.socket.snd-buffer-size</td>\n", 
            "+                    <td>\n", 
            "+                        Set the size of the buffers used by the underlying platform\n", 
            "+                        for outgoing network I/O. This value is only a hint. When set, this is a\n", 
            "+                        suggestion to the OS kernel from Synapse about the size of buffers to\n", 
            "+                        use for the data to be sent over the socket\n", 
            "+                        (See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#SO_SNDBUF\">SO_SNDBUF</a>).\n", 
            "+                        <div class=\"xmlConf\">http.socket.snd-buffer-size=4096</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>8192</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.socket.linger</td>\n", 
            "+                    <td>\n", 
            "+                        Specify the linger-on-close timeout duration (in milliseconds) for the\n", 
            "+                        sockets created by the HTTP transport. Setting to 0 or a negative value\n", 
            "+                        disables linger-on-close\n", 
            "+                        (See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#SO_LINGER\">SO_LINGER</a>).\n", 
            "+                        <div class=\"xmlConf\">http.socket.linger=5000</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>-1</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.socket.reuseaddr</td>\n", 
            "+                    <td>\n", 
            "+                        Set the <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/net/SocketOptions.html#SO_REUSEADDR\">SO_REUSEADDR</a>\n", 
            "+                        socket option for the sockets created by the HTTP transport. Accepted\n", 
            "+                        values are either 'true' or 'false'.\n", 
            "+                        <div class=\"xmlConf\">http.socket.reuseaddr=true</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>false</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.nio.select-interval</td>\n", 
            "+                    <td>\n", 
            "+                        Set the time interval in milliseconds at which the I/O reactor wakes up\n", 
            "+                        to check for timed out sessions and session requests.\n", 
            "+                        <div class=\"xmlConf\">http.nio.select-interval=2500</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>1000</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>io_threads_per_reactor</td>\n", 
            "+                    <td>\n", 
            "+                        Set the number of I/O dispatcher threads to be used by each I/O reactor.\n", 
            "+                        Typically, this property controls the ability of the HTTP transport\n", 
            "+                        to handle concurrent I/O events.\n", 
            "+                        It is recommended that this property is set to the number of CPU cores\n", 
            "+                        available for Synapse. By default, Synapse determines the number of\n", 
            "+                        available CPU cores and initializes this setting accordingly.\n", 
            "+                        <div class=\"xmlConf\">io_threads_per_reactor=4</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>Number of CPU cores</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.malformed.input.action</td>\n", 
            "+                    <td>\n", 
            "+                        Specify the action to be performed when a malformed input is detected\n", 
            "+                        during character set encoding or decoding. Supported values are\n", 
            "+                        'ignore', 'replace' and 'report'. See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/nio/charset/CodingErrorAction.html\">CodingErrorAction</a>\n", 
            "+                        for more details on each of these options.\n", 
            "+                        <div class=\"xmlConf\">http.malformed.input.action=ignore</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>report</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>http.unmappable.input.action</td>\n", 
            "+                    <td>\n", 
            "+                        Specify the action to be performed when an un-mappable character is detected\n", 
            "+                        during character set encoding or decoding. Supported values are\n", 
            "+                        'ignore', 'replace' and 'report'. See <a href=\"http://docs.oracle.com/javase/1.5.0/docs/api/java/nio/charset/CodingErrorAction.html\">CodingErrorAction</a>\n", 
            "+                        for more details on each of these options.\n", 
            "+                        <div class=\"xmlConf\">http.malformed.input.action=ignore</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>report</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>worker_pool_size_core</td>\n", 
            "+                    <td>\n", 
            "+                        Initial size of the internal thread pool used by the Pass\n", 
            "+                        Through HTTP transport. This thread pool is used for mediating\n", 
            "+                        messages through the Synapse mediation engine. Note that both HTTP\n", 
            "+                        listener and sender draw threads from this pool. It is further shared\n", 
            "+                        between the HTTP and HTTPS transports. The size of this thread pool\n", 
            "+                        determines the capacity of Synapse to mediate concurrent HTTP messages.\n", 
            "+                        <div class=\"xmlConf\">worker_pool_size_core=100</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>40</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>worker_pool_size_max</td>\n", 
            "+                    <td>\n", 
            "+                        The thread pool used by the Pass Through HTTP transport grows in size, as\n", 
            "+                        more and more jobs are submitted to it. This property determines the\n", 
            "+                        maximum limit up to which the thread pool may grow. In other words,\n", 
            "+                        this property specifies the maximum number of threads that may ever exist\n", 
            "+                        in the transport thread pool. Value of this property must be greater than\n", 
            "+                        or equal to the vallue of worker_pool_size_core.\n", 
            "+                        <div class=\"xmlConf\">worker_pool_size_max=500</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>200</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>worker_thread_keepalive_sec</td>\n", 
            "+                    <td>\n", 
            "+                        Specify the idle time period (in seconds) for the excessive threads in\n", 
            "+                        the Pass Through transport thread pool. Once a thread in the pool has\n", 
            "+                        been idle for this duration, it will be removed from the pool and\n", 
            "+                        destroyed. This reduces the size of the thread pool, but the thread pool\n", 
            "+                        size is not allowed drop below the value of the worker_pool_size_core\n", 
            "+                        property.\n", 
            "+                        <div class=\"xmlConf\">worker_thread_keepalive_sec=10</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>60</td>\n", 
            "+                </tr>\n", 
            "+                <tr>\n", 
            "+                    <td>worker_pool_queue_length</td>\n", 
            "+                    <td>\n", 
            "+                        Determines the length of the queue used by the Pass Through transport\n", 
            "+                        thread pool to store pending jobs. To use an unbounded queue, set this\n", 
            "+                        property to -1. If a bounded queue is used, and if the queue ever gets\n", 
            "+                        filled to its capacity, any further attempts to submit jobs will fail,\n", 
            "+                        causing some messages to be dropped by Synapse.\n", 
            "+                        <div class=\"xmlConf\">worker_pool_queue_length=1000</div>\n", 
            "+                    </td>\n", 
            "+                    <td>No</td>\n", 
            "+                    <td>-1</td>\n", 
            "+                </tr>\n", 
            "+            </table>\n", 
            "+            <p>\n", 
            "+                Note that all the above settings are optional. In fact the entire passthru-http.properties\n", 
            "+                file is optional. Synapse is programmed with some reasonable default values (also\n", 
            "+                given in the table) for each of the above settings. However, it is highly\n", 
            "+                recommended to tweak the above values to obtain best performance from the\n", 
            "+                Pass Through HTTP transport. At least, consider tuning the worker_pool_size_core\n", 
            "+                and worker_pool_size_max to match the expected load in your deployment.\n", 
            "+            </p>\n", 
            "+            <p>\n", 
            "+                Users deploying Synapse on Unix/Linux systems are further advised to set the\n", 
            "+                following OS level configuration parameters. This is completely optional, but\n", 
            "+                for high-throughput and high-volume deployments, configuring these parameters\n", 
            "+                may be crucial.\n", 
            "+            </p>\n", 
            "+            <ul>\n", 
            "+                <li>\n", 
            "+                    Increase the limit on open file descriptors by editing the\n", 
            "+                    /etc/security/limits.conf file.\n", 
            "+                    <div class=\"xmlConf\">* soft nofile 4096\n", 
            "+* hard nofile 65535</div>\n", 
            "+                </li>\n", 
            "+                <li>\n", 
            "+                    Increase the TCP port range and optimize other TCP settings in the\n", 
            "+                    /etc/sysctl.conf file.\n", 
            "+                    <div class=\"xmlConf\">net.ipv4.tcp_fin_timeout = 30\n", 
            "+fs.file-max = 2097152\n", 
            "+net.ipv4.tcp_tw_recycle = 1\n", 
            "+net.ipv4.tcp_tw_reuse = 1\n", 
            "+net.core.rmem_default = 524288\n", 
            "+net.core.wmem_default = 524288\n", 
            "+net.core.rmem_max = 67108864\n", 
            "+net.core.wmem_max = 67108864\n", 
            "+net.ipv4.tcp_rmem = 4096 87380 16777216\n", 
            "+net.ipv4.tcp_wmem = 4096 65536 16777216\n", 
            "+net.ipv4.ip_local_port_range = 1024 65535</div>\n", 
            "+                </li>\n", 
            "+            </ul>\n", 
            "+        </section>\n", 
            "     </body>\n", 
            " </document>\n", 
            "\\ No newline at end of file\n"
          ]
        }
      ], 
      "to": "java/modules/documentation/src/site/xdoc/userguide/transports/pass_through.xml", 
      "from": "java/modules/documentation/src/site/xdoc/userguide/transports/pass_through.xml"
    }
  ], 
  "id": "1513283"
}