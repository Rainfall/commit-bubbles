{
  "when": "2011-12-08T05:59:31-05:00", 
  "message": "Updated sample 53 test", 
  "who": "hiranya", 
  "changes": [
    {
      "chunks": [
        {
          "locn": "-44,29 +44,74", 
          "lines": [
            "         addUrl = \"http://localhost:8280/services/LBService1\";\n", 
            "         log.info(\"Running test: Failover sending among 3 endpoints\");\n", 
            " \n", 
            "+        // Send some messages and check\n", 
            "         Thread t = new Thread(new Runnable() {\n", 
            "             public void run() {\n", 
            "-                result = client.sessionlessClient(addUrl, null, 10000);\n", 
            "+                result = client.sessionlessClient(addUrl, null, 10);\n", 
            "             }\n", 
            "         });\n", 
            "         t.start();\n", 
            "+        try {\n", 
            "+            t.join();\n", 
            "+        } catch (InterruptedException e) {\n", 
            " \n", 
            "-        for (int i = 0; i < 3; i++) {\n", 
            "-            try {\n", 
            "-                Thread.sleep(2000);\n", 
            "-            } catch (InterruptedException e) {\n", 
            "+        }\n", 
            "+        assertResponseReceived(result);\n", 
            " \n", 
            "+        // Stop BE server 1\n", 
            "+        getBackendServerControllers().get(0).stop();\n", 
            "+        try {\n", 
            "+            Thread.sleep(2000);\n", 
            "+        } catch (InterruptedException e) {\n", 
            "+\n", 
            "+        }\n", 
            "+\n", 
            "+        // Send another burst of messages and check\n", 
            "+        t = new Thread(new Runnable() {\n", 
            "+            public void run() {\n", 
            "+                result = client.sessionlessClient(addUrl, null, 10);\n", 
            "             }\n", 
            "-            getBackendServerControllers().get(i).stop();\n", 
            "+        });\n", 
            "+        t.start();\n", 
            "+        try {\n", 
            "+            t.join();\n", 
            "+        } catch (InterruptedException e) {\n", 
            "+\n", 
            "         }\n", 
            "+        assertResponseReceived(result);\n", 
            " \n", 
            "+        // Stop BE server 2\n", 
            "+        getBackendServerControllers().get(1).stop();\n", 
            "         try {\n", 
            "+            Thread.sleep(2000);\n", 
            "+        } catch (InterruptedException e) {\n", 
            "+\n", 
            "+        }\n", 
            "+\n", 
            "+        // Send some more messages and check\n", 
            "+        t = new Thread(new Runnable() {\n", 
            "+            public void run() {\n", 
            "+                result = client.sessionlessClient(addUrl, null, 10);\n", 
            "+            }\n", 
            "+        });\n", 
            "+        t.start();\n", 
            "+        try {\n", 
            "             t.join();\n", 
            "         } catch (InterruptedException e) {\n", 
            " \n", 
            "         }\n", 
            "+        assertResponseReceived(result);\n", 
            " \n", 
            "-        assertResponseReceived(result);\n", 
            "+        // Stop BE server 3\n", 
            "+        getBackendServerControllers().get(2).stop();\n", 
            "+        try {\n", 
            "+            Thread.sleep(2000);\n", 
            "+        } catch (InterruptedException e) {\n", 
            "+\n", 
            "+        }\n", 
            "+\n", 
            "+        // Send another message - Should fail\n", 
            "+        result = client.sessionlessClient(addUrl, null, 1);\n", 
            "         Exception resultEx = result.getException();\n", 
            "         assertNotNull(\"Did not receive expected error\", resultEx);\n", 
            "         log.info(\"Got an error as expected: \" + resultEx.getMessage());\n"
          ]
        }
      ], 
      "to": "java/modules/integration/src/test/java/org/apache/synapse/samples/framework/tests/endpoint/Sample53.java", 
      "from": "java/modules/integration/src/test/java/org/apache/synapse/samples/framework/tests/endpoint/Sample53.java"
    }
  ], 
  "id": "1211822"
}